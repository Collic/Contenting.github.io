"use strict";function sendPost(e,t,a,n){$.ajax({url:e,data:t,dataType:"json",type:"post",contentType:"application/json;charset=UTF-8",success:a,error:n})}function requireCallback(){require(["echarts","echarts/chart/map","echarts/chart/pie","echarts/chart/line"],function(e){map(e),pie1(e),pie2(e),pie3(e),pie4(e),line(e)})}function map(e){var t=new Map(e);t.mapDom(),t.fetchDataInterval=3e5,t.delayMapTime=5e3,t.updateDataArr();setInterval(t.updateDataArr,t.fetchDataInterval)}function Map(e){this.data={},this.dataArr=[],this.fetchDataInterval=0,this.delayMapTime=0,this.mapTimer=0,this.feedbackData=[],this.updateDataArr=function(){this.updateTop5Table(),this.count=1,this.dataArr.length<=0?this.fetchMapdata():this.feedbackData=[]}.bind(this),this.fetchMapdata=function(){sendPost(baseURL+"/dataService/investLoan/investTrends.api","",function(e){var t=e.datas;null==t&&(t=[]),this.feedbackData=this.feedbackDatatransform(t,[]),clearInterval(this.mapTimer),this.dataArr=this.dataArr.concat(this.feedbackData),this.updateMapData(),this.mapTimer=setInterval(this.updateMapData,this.delayMapTime)}.bind(this),function(){this.feedbackData=[]}.bind(this))}.bind(this),this.feedbackDatatransform=function(e,t){var a=[];return e.map(function(e,t){var n={CityName:e[0].loanprovince},i=[];return e.map(function(e,t){i.push({InvestAmount:Number(e.investamount),CityName:e.investprovince})}),a.push({LoanUser:n,InvestUsers:i}),a}),a},this.count=1,this.frag,this.fragForDes,this.mapSvgForDesDom=document.getElementById("mapSvgForDes"),this.mapSvgDom=document.getElementById("mapSvg"),this.mapSvgForDes=this.mapSvgForDesDom.innerHTML,this.mapSvg=this.mapSvgDom.innerHTML,this.updateMapData=function(){switch(this.mapSvgForDesDom.innerHTML=this.mapSvgForDes,this.mapSvgDom.innerHTML=this.mapSvg,this.frag=document.createDocumentFragment(),this.fragForDes=document.createDocumentFragment(),this.count){case 2:if(this.dataArr.length>=2)for(var e=0;e<2;e++)this.data=this.dataArr[0],this.showLoanRelationshipInMap(this.data),this.dataArr.shift();break;case 3:if(this.dataArr.length>=3)for(var e=0;e<3;e++)this.data=this.dataArr[0],this.showLoanRelationshipInMap(this.data),this.dataArr.shift();break;default:this.dataArr.length>=1&&(this.data=this.dataArr[0],this.showLoanRelationshipInMap(this.data),this.dataArr.shift())}this.mapSvgForDesDom.appendChild(this.fragForDes),this.mapSvgDom.appendChild(this.frag)}.bind(this),this.top5Arr=[["上海","icons topIcon","4,859,2181"],["北京","icons downIcon","4,859,218"],["江苏","icons flatIcon","4,859,218"],["湖南","icons topIcon","4,859,218"],["四川","icons flatIcon","4,859,218"]],this.top5TbodyDom=document.getElementsByClassName("top5-tbody")[0],this.updateTop5Table=function(){this.fetchTopData()},this.fetchTopData=function(){sendPost(baseURL+"/dataService/ranking/Investmentstics.api","",function(e){this.top5Arr=[];var t=e.datas,a=[],n=[],i=[],r=[],o=[],s=[];for(var l in t)o.push(l),s.push(t[l]);for(var c=o.sort(),l=0;l<c.length;l++){var d=c[l];"float"==d.slice(0,d.length-1)&&(t[d]="1"==t[d]?"icons topIcon":"0"==t[d]?"icons flatIcon":"icons downIcon",a.push(t[d])),"rownum"==d.slice(0,d.length-1)&&n.push(t[d]),"province"==d.slice(0,d.length-1)&&(t[d]=t[d].slice(0,2),"内蒙"==t[d]&&(t[d]="内蒙古"),"黑龙"==t[d]&&(t[d]="黑龙江"),i.push(t[d])),"amount"==d.slice(0,d.length-1)&&r.push(filter(String((1*t[d]).toFixed(2))))}for(var l=0;l<a.length;l++){var h=[];h.push(i[l]),h.push(a[l]),h.push(r[l]),this.top5Arr.push(h)}for(var m=this.top5Arr.length>4?5:this.top5Arr.length,u="",l=0;l<m;l++)u+="\n               <tr>\n                  <td><span>"+this.top5Arr[l][0]+'</span><i class="'+this.top5Arr[l][1]+'"></i></td>\n                  <td>'+this.top5Arr[l][2]+"</td>\n               </tr>     \n          ";this.top5TbodyDom.innerHTML=u}.bind(this),function(){this.top5TbodyDom.innerHTML=""}.bind(this))}.bind(this),this.mapDom=function(){var t=e.init(document.getElementById("main")),a={};var n={color:["gold","aqua","lime"],title:{x:"center",textStyle:{color:"#fff"}},tooltip:{trigger:"item",formatter:"{b}"},dataRange:{show:!1,min:0,max:100,calculable:!0,color:["#a88f55","#a88f55"],textStyle:{color:"#fff"}},series:[{name:"全国",type:"map",roam:!1,hoverable:!1,mapType:"china",itemStyle:{normal:{color:"transparent",borderColor:"rgba(92,187,255,0.79) ",borderWidth:1.2,areaStyle:{color:"#1b1b1b"}}},data:[],markLine:{smooth:!0,symbol:["none","circle"],symbolSize:1,itemStyle:{normal:{color:"#fff",borderWidth:1,borderColor:"rgba(30,144,255,0.5)"}},data:[]},geoCoord:a}]};t.setOption(n)},this.showLoanRelationshipInMap=function(e){for(var t=e.LoanUser.CityName.toString(),a=[],n=[],i=0;i<e.InvestUsers.length;i++)a[i]=e.InvestUsers[i].CityName,n[i]=filter(String((1*e.InvestUsers[i].InvestAmount).toFixed(0)));for(var i=0;i<a.length;i++)a[i]=this.compareCityName(a[i],this.geoCoord2),t=this.compareCityName(t,this.geoCoord2),0==a[i]||0==t||this.showPathFlowInMap(this.geoCoord2[a[i]],this.geoCoord2[t],n[i])}.bind(this),this.compareCityName=function(e,t){for(var a in t)if(e.slice(0,2)==a.slice(0,2))return a;return!1},this.changeGeoToPos=function(e){var t=_slicedToArray(e,2),a=t[0],n=t[1],i=[];return i[0]=(a-66.8)*(800/74.7).toFixed(4),i[1]=540/37.7*-(n-54.65),i},this.showPathFlowInMap=function(e,t,a){e=this.changeGeoToPos(e),t=this.changeGeoToPos(t);var n=document.createElementNS("http://www.w3.org/2000/svg","g");n.innerHTML+='       \n        <circle cx="'+t[0]+'" cy="'+t[1]+'" r="8" fill="url(#grad5)" /> \n        <circle cx="'+t[0]+'" cy="'+t[1]+'" r="7" stroke="#3C99EB" stroke-width="1" fill="transparent" />     \n        <circle cx="'+e[0]+'" cy="'+e[1]+'" r="15"  fill="rgba(77,71,58,0.18)" />     \n        <circle cx="'+e[0]+'" cy="'+e[1]+'" r="4" stroke="#7B6B49"  stroke-width="1" fill="transparent" />\n        <circle cx="'+e[0]+'" cy="'+e[1]+'" r="2" fill="#D1882D" />\n        <circle cx="'+e[0]+'" cy="'+e[1]+'" r="12" stroke="url(#grad4)"  stroke-width="12" fill="transparent" />      \n        <text x="'+(e[0]-20)+'" y="'+(e[1]-15)+'" fill="#e9c36a" font-size="10">'+a+"元</text>\n        ",this.fragForDes.appendChild(n),this.createPath(e,t)},this.createPath=function(e,t){var a=e,n=t,i=1.1*Math.sqrt(Math.pow(Math.abs(a[0]-n[0]),2)+Math.pow(Math.abs(a[1]-n[1]),2)),r=a[0]<n[0]?"grad1":"grad3",o=(a[0],n[0],"1"),s=parseInt(this.delayMapTime/1e3),l=document.createElementNS("http://www.w3.org/2000/svg","g");l.innerHTML+=' \n        <path d="M'+a[0]+" "+a[1]+" A"+i+","+i+" 0 0,"+o+" "+n[0]+","+n[1]+'" stroke-width="2.5" stroke="#1B3E5D"  fill="transparent" filter="url(#f1)"/>  \n        <path d="M'+a[0]+" "+a[1]+" A"+i+","+i+" 0 0,"+o+" "+n[0]+","+n[1]+'" stroke-width="2" stroke="url(#'+r+')"  fill="transparent" id="route'+a[0]+a[1]+"_"+n[0]+n[1]+'"/>       \n        <image  x="-17" y="-10.7" width="25px" xlink:href="./images/arrows.png">              \n        <animateMotion              \n                  dur="'+s+'s"\n                   begin="0.22s"\n                   fill="freeze"\n                   repeatCount="indefinite"\n                   rotate="auto"> \n                   <mpath xlink:href="#route'+a[0]+a[1]+"_"+n[0]+n[1]+'" />         \n        </animateMotion>            \n        </image>  \n        ',this.frag.appendChild(l)},this.geoCoord2={"新疆":[85.260517,40.212322],"西藏":[87.231383,32.138361],"青海":[95.449435,35.782312],"吉林":[126.474637,43.484827],"辽宁":[122.783206,41.409775],"河北":[115.356429,38.065381],"山东":[117.993137,36.066846],"江苏":[119.487321,33.321369],"浙江":[119.926745,28.92163],"安徽":[117.158207,32,324293],"河南":[113.422855,33.79742],"山西":[112.324187,37.5097],"陕西":[109.511733,35.603736],"甘肃":[104.765608,34.52466],"湖北":[112.10449,31.052942],"江西":[115.708002,27.683528],"福建":[117.993141,25.918509],"湖南":[111.840827,27.332753],"贵州":[106.918927,26.588519],"四川":[102.480465,30.675719],"云南":[101.689438,24.447143],"海南":[109.819341,18.895903],"上海":[121.332992,30.939921],"重庆":[107.578122,29.611676],"天津":[117.421877,39.061852],"北京":[116.455092,40.111698],"宁夏":[106.259754,37.335212],"内蒙古":[109.335914,40,979877],"广西":[108.984361,23.322074],"广东":[113.225096,23.523708],"香港":[113.92886,22.220901],"台湾":[121.02539,23.604261],"澳门":[113.546811,22.185227],"黑龙江":[127.001924,47.783627],"深圳":[114.076542,22.530327]}}function pie1(e){function t(){sendPost(baseURL+"/dataService/invest/TerraceDate.api","",function(e){if(e.datas)var t=[{value:e.datas.terrace14Date,name:"14天标"},{value:e.datas.terrace1month,name:"1月标"},{value:e.datas.terrace3month,name:"3月标"},{value:e.datas.terrace3_12month,name:"12月标"},{value:e.datas.terrace12_24month,name:"24月标"}];else var t=[{value:0,name:"14天标"},{value:0,name:"1月标"},{value:0,name:"3月标"},{value:0,name:"12月标"},{value:0,name:"24月标"}];n.series[0].data=t,a.setOption(n)})}var a=e.init(document.getElementById("pie1")),n={title:{text:"平台标的\n期限",x:"center",y:"46",textStyle:{fontSize:9,color:"#fff"}},color:["#6ccefd","#20a0fb","#2458fa","#764bfa","#5d09f9"],legend:{show:!1,orient:"vertical",y:"165",x:"left",bottom:"20%",width:100,itemWidth:10,itemHeight:10,textStyle:{color:"#fff",fontSize:11},data:[{name:"14天标",icon:"bar"},{name:"1月标",icon:"bar"},{name:"3月标",icon:"bar"},{name:"12月标",icon:"bar"},{name:"24月标",icon:"bar"}]},toolbox:{show:!1},calculable:!1,series:[{name:"",type:"pie",radius:[40,55],center:["50%","40%"],itemStyle:{normal:{label:{show:!1},labelLine:{show:!1}}},data:[]}]};t(),setInterval(t,864e5)}function pie2(e){function t(){sendPost(baseURL+"/dataService/invest/TerraceSum.api","",function(e){if(e.datas)var t=[{value:e.datas.terraceSum1000,name:"0-1000元"},{value:e.datas.terraceSum1001_10000,name:"1001-10000元"},{value:e.datas.terraceSum10001_100000,name:"10001-100000元"},{value:e.datas.terraceSum100000,name:"100000元以上"}];else var t=[{value:0,name:"0-1000元"},{value:0,name:"1001-10000元"},{value:0,name:"10001-100000元"},{value:0,name:"100000元以上"}];n.series[0].data=t,a.setOption(n)})}var a=e.init(document.getElementById("pie2")),n={title:{text:"平台标的\n金额",x:"center",y:"46",textStyle:{fontSize:9,color:"#fff"}},color:["#6ccefd ","#20a0fb","#764bfa","#5d09f9"],legend:{show:!1,orient:"vertical",x:"20",y:"165",itemWidth:10,itemHeight:10,textStyle:{color:"#fff",fontSize:11},data:[{name:"0-1000元",icon:"bar"},{name:"1001-10000元",icon:"bar"},{name:"10001-100000元",icon:"bar"},{name:"100000元以上",icon:"bar"}]},toolbox:{show:!1},calculable:!1,series:[{name:"",type:"pie",radius:[40,55],center:["50%","40%"],itemStyle:{normal:{label:{show:!1},labelLine:{show:!1}}},data:[]}]};t(),setInterval(t,864e5)}function pie3(e){function t(){sendPost(baseURL+"/dataService/invest/AgeDistributed.api","",function(e){if(e.datas)var t=[{value:e.datas.ageDistributed25,name:"25岁以下"},{value:e.datas.ageDistributed25_35,name:"26-35岁"},{value:e.datas.ageDistributed35_45,name:"36-45岁"},{value:e.datas.ageDistributed45_55,name:"46-55岁"},{value:e.datas.ageDistributed55,name:"55岁以上"}];else var t=[{value:0,name:"25岁以下"},{value:0,name:"26-35岁"},{value:0,name:"36-45岁"},{value:0,name:"46-55岁"},{value:0,name:"55岁以上"}];n.series[0].data=t,a.setOption(n)})}var a=e.init(document.getElementById("pie3")),n={title:{text:"年龄\n分布",x:"center",y:"46",textStyle:{fontSize:9,color:"#fff"}},color:["#6ccefd","#b0a7fc","#5d09f9","#20a0fb","#764bfa"],legend:{show:!1,orient:"vertical",x:"left",y:"165",itemWidth:10,itemHeight:10,textStyle:{color:"#fff",fontSize:11},data:[{name:"25岁以下",icon:"bar"},{name:"26-35岁",icon:"bar"},{name:"36-45岁",icon:"bar"},{name:"46-55岁",icon:"bar"},{name:"55岁以上",icon:"bar"}]},toolbox:{show:!1},calculable:!1,series:[{name:"",type:"pie",radius:[40,55],center:["50%","40%"],itemStyle:{normal:{label:{show:!1},labelLine:{show:!1}}},data:[]}]};t(),setInterval(t,864e5)}function pie4(e){var t=e.init(document.getElementById("pie4")),a={normal:{color:"#70D0FF",label:{show:!1},labelLine:{show:!1}}},n={normal:{color:"#275FFF",label:{show:!1},labelLine:{show:!1}}},i={normal:{color:"#4B84B7",label:{show:!1},labelLine:{show:!1}}},r={normal:{color:"#1F41B8",label:{show:!1},labelLine:{show:!1}}},o={normal:{color:"#2D4B6D",label:{show:!1},labelLine:{show:!1}}},s={normal:{color:"#162971",label:{show:!1},labelLine:{show:!1}}},l={noDataLoadingOption:{text:"暂无数据",effect:"bubble",effectOption:{effect:{n:0}}},title:{text:"完成比例",subtext:donePercent+"%",x:"center",y:"center",textStyle:{color:"#CBCBCC",fontSize:12},subtextStyle:{color:"#60B2DE",fontWeight:"bold",fontSize:12},itemGap:0},legend:{data:["","",""]},series:[{type:"pie",clockWise:!0,radius:[58,66],itemStyle:a,data:[{value:100-donePercent,name:"visible",itemStyle:n},{value:donePercent,name:"1"}]},{type:"pie",clockWise:!0,radius:[53,58],itemStyle:i,data:[{value:100-donePercent,name:"visible",itemStyle:r},{value:donePercent,name:"2"}]},{type:"pie",clockWise:!0,radius:[47,53],itemStyle:o,data:[{value:100-donePercent,name:"visible",itemStyle:s},{value:donePercent,name:"3"}]}]};t.setOption(l)}function line(e){function t(){sendPost(baseURL+"dataService/investLoan/investForDay.api","",function(e){var t=e.datas.repayResultList;0==t.length&&t.push({value:0,symbol:null,symbolSize:0});for(var i=[],r=0;r<t.length;r++)i.push(Number(1e-4*t[r]).toFixed(2));n.series[0].data=i;var o=e.datas.loanResultList;0==t.length&&0==o.length&&o.push({value:0,symbol:null,symbolSize:0});for(var s=[],r=0;r<o.length;r++)s.push(Number(1e-4*o[r]).toFixed(2));n.series[1].data=s,a.setOption(n)},function(){var e=[];e.push({value:0,symbol:null,symbolSize:0});for(var t=[],i=0;i<e.length;i++)t.push(Number(1e-4*e[i]).toFixed(2));n.series[0].data=t,a.setOption(n)})}var a=e.init(document.getElementById("line")),n={color:["#c03d06","#f9e25e"],tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c}"},legend:{x:"335",y:"35",align:"right",textStyle:{color:"#fff"},itemWidth:15,itemHeight:10,data:["投资额","还款额"]},grid:{x:50,borderWidth:0},xAxis:[{type:"category",boundaryGap:!1,axisLine:{show:!1},splitLine:{show:!1},axisTick:!1,axisLabel:{show:!0,textStyle:{color:"#fff"}},data:["00:00","03:00","06:00","9:00","12:00","15:00","18:00","21:00","24:00"]}],yAxis:[{name:"单位：万",splitNumber:6,min:0,max:6e3,type:"value",axisLine:{show:!0,lineStyle:{width:0,color:"#fff"}},splitLine:{lineStyle:{color:"rgba(255, 255, 255,0.3)"}},axisLabel:{formatter:"{value}",textStyle:{color:"#fff"}}}],calculable:!1,series:[{name:"还款额",type:"line",smooth:!0,itemStyle:{normal:{label:{show:!0,position:"top",formatter:function(e){var t=new Array;t=n.series[0].data;var a=n.xAxis[0].data,i=t.indexOf(t.max());return e.name==a[i]&&0!=t.max()?e.value+"万":""}}}},data:[]},{name:"投资额",itemStyle:{normal:{label:{show:!0,position:"top",formatter:function(e){var t=new Array;t=n.series[1].data;var a=n.xAxis[0].data,i=t.indexOf(t.max());return e.name==a[i]&&0!=t.max()?e.value+"万":""}}}},type:"line",data:[]}]};t(),setInterval(t,3e5)}function investTotalAmount(){sendPost(baseURL+"/dataService/invest/investTotalAmount.api","",function(e){e.datas.investTotal?$("#money-center").text(filter(String(e.datas.investTotal))):$("#money-center").text("0")},function(e){$("#money-center").text("0")})}function TotalInvestment(){sendPost(baseURL+"/dataService/invest/TotalInvestment.api","",function(e){e.datas.count?$("#help-borrowers").text(filter(String(e.datas.count))):$("#help-borrowers").text("0")},function(e){$("#help-borrowers").text("0")})}function Enrollment(){sendPost(baseURL+"/dataService/invest/Enrollment.api","",function(e){e.datas.totalRegister?$("#registered-numbers").text(filter(String(e.datas.totalRegister))):$("#registered-numbers").text("0")},function(e){$("#registered-numbers").text("0")})}function transactionTotal(){sendPost(baseURL+"/dataService/invest/transactionTotal.api","",function(e){e.datas.transactionTotal?$("#transaction-quantities").text(filter(String(e.datas.transactionTotal))):$("#transaction-quantities").text("0")},function(e){$("#transaction-quantities").text("0")})}function earnTotalEarnings(){sendPost(baseURL+"/dataService/invest/earnTotalEarnings.api","",function(e){e.datas.earnTotalEarnings?$("#total-revenue").text(filter(String((1e-4*e.datas.earnTotalEarnings).toFixed(2)))):$("#total-revenue").text("0")},function(e){$("#total-revenue").text("0")})}function waitRepaymentPrincipal(){sendPost(baseURL+"/dataService/invest/waitRepaymentPrincipal.api","",function(e){e.datas.waitRepaymentPrincipal?$("#repayment-principal").text(filter(String((1e-4*e.datas.waitRepaymentPrincipal).toFixed(2)))):$("#repayment-principal").text("0")},function(e){$("#repayment-principal").text("0")})}function investAverage(){sendPost(baseURL+"/dataService/investInfo/investAverage.api","",function(e){e.datas.investaverage?$("#average-investment").text(filter(String((1e-4*e.datas.investaverage).toFixed(2)))):$("#average-investment").text("0")},function(e){$("#average-investment").text("0")})}function doloanAverage(){sendPost(baseURL+"/dataService/investInfo/doloanAverage.api","",function(e){e.datas.loanaverage?$("#average-loan").text(filter(String((1e-4*e.datas.loanaverage).toFixed(2)))):$("#average-loan").text("0")},function(e){$("#average-loan").text("0")})}function doloanspeed(){sendPost(baseURL+"/dataService/investInfo/doloanspeed.api","",function(e){e.datas.loanspeed?$("#fullscale-speed").text(filter(String(e.datas.loanspeed))):$("#fullscale-speed").text("0")},function(e){$("#fullscale-speed").text("0")})}function filter(e){return e.split("").reverse().join("").replace(/(\d{3})/g,"$1,").replace(/\,$/,"").split("").reverse().join("")}function autoScroll(e){$(e).find("div").animate({marginTop:"-32px"},500,function(){$(this).css({marginTop:"0px"}).find("a:first").appendTo(this)}),$(e).find("a :eq(3)").addClass("active").siblings().removeClass("active")}function flipDown(){var e=Math.round(new Date("5/10/2016 00:00:01").getTime()/1e3);$("#new_year").flipcountdown({tick:function(){var t=e-Math.round((new Date).getTime()/1e3),a=parseInt(t/86400);return function(e){return e>9?e:""+e}(a)}})}var _slicedToArray=function(){function e(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw r}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),baseURL="/api/";require.config({paths:{echarts:"vendor/echarts/build/dist"}}),Array.prototype.max=function(){for(var e=this[0],t=this.length,a=1;a<t;a++)this[a]>e&&(e=this[a]);return e},investTotalAmount(),setInterval(investTotalAmount,3e5),TotalInvestment(),setInterval(TotalInvestment,3e5),Enrollment(),setInterval(Enrollment,3e5),transactionTotal(),setInterval(transactionTotal,3e5),earnTotalEarnings(),setInterval(earnTotalEarnings,3e5),waitRepaymentPrincipal(),setInterval(waitRepaymentPrincipal,3e5),investAverage(),setInterval(investAverage,3e5),doloanAverage(),setInterval(doloanAverage,3e5),doloanspeed(),setInterval(doloanspeed,3e5);var haveDone=$(".percent i:contains(已完成)").length,inProgress=$(".percent i:contains(进行中)").length;$(".percent i:contains(进行中)").css("color","#2c60ea");var donePercent=(haveDone/(haveDone+inProgress)*100).toFixed(2);$(function(){requireCallback(),flipDown(),setInterval(autoScroll,3e3,".process-list")});